<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Local Test Maker</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>Local Test Maker</h1>
    <a href="create.html"><button>+ Create Test</button></a>
    <h2>Your Tests</h2>
    <div id="list">Loading...</div>
    <h3>Import Test</h3>
    <textarea id="importJson" rows="6" placeholder="Paste exported JSON here..."></textarea><br>
    <button onclick="importTest()">Import</button>
  </div>

  <script>
    async function loadTests() {
      const res = await fetch('/api/tests');
      const tests = await res.json();
      document.getElementById('list').innerHTML = tests.length === 0 ?
        '<p>No tests yet. Create one!</p>' :
        tests.map(t => `
          <div class="test-item">
            <strong>${t.title}</strong> (${t.question_count} questions)<br><br>
            <a href="take.html?id=${t.id}" class="btn">Take Test</a>
            <button class="btn" onclick="exportTest(${t.id})">Export</button>
            <button class="btn red" onclick="deleteTest(${t.id})">Delete</button>
          </div>
        `).join('');
    }
    async function deleteTest(id) { if(confirm('Delete?')) { await fetch('/api/tests/'+id, {method:'DELETE'}); loadTests(); } }
    async function exportTest(id) {
      const res = await fetch('/api/export/'+id);
      const data = await res.json();
      navigator.clipboard.writeText(JSON.stringify(data, null, 2));
      alert('Copied to clipboard!');
    }
    async function importTest() {
      try {
        const data = JSON.parse(document.getElementById('importJson').value);
        await fetch('/api/import', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data)});
        alert('Imported!'); document.getElementById('importJson').value=''; loadTests();
      } catch { alert('Invalid JSON'); }
    }
    loadTests();
  </script>
</body>
</html>