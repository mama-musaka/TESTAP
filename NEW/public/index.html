<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="utf-8">
  <title>Тестова система</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { margin:0; background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height:100vh; font-family:'Segoe UI',sans-serif; }
    .container { max-width:1000px; margin:40px auto; background:white; padding:50px; border-radius:20px; box-shadow:0 20px 60px rgba(0,0,0,0.2); text-align:center; }
    h1 { font-size:48px; color:#2c3e50; margin-bottom:20px; }
    .btn {
      display:inline-block; padding:18px 45px; margin:20px; font-size:22px; border-radius:50px;
      text-decoration:none; color:white; font-weight:bold; box-shadow:0 10px 30px rgba(0,0,0,0.3);
      transition:all 0.3s;
    }
    .btn:hover { transform:translateY(-5px); box-shadow:0 15px 40px rgba(0,0,0,0.4); }
    .create { background:#06d6a0; }
    .dashboard { background:#480057; }

    .test-card {
      margin:30px auto; padding:28px; background:#f8fbff; border-radius:18px;
      border-left:8px solid #4361ee; box-shadow:0 12px 35px rgba(0,0,0,0.12); max-width:900px;
      text-align:left;
    }
    .test-card h3 { margin:0 0 12px 0; font-size:26px; color:#2c3e50; }
    .actions { margin-top:20px; display:flex; flex-wrap:wrap; gap:14px; align-items:center; justify-content:flex-start; }
    .share-btn {
      background:#25d366; color:white; padding:14px 28px; border:none; border-radius:50px; cursor:pointer;
      font-weight:bold; font-size:17px; box-shadow:0 8px 25px rgba(37,211,102,0.4); transition:all 0.3s;
    }
    .share-btn:hover { background:#128C7E; transform:translateY(-3px); }
    .copied { color:#06d6a0; font-weight:bold; opacity:0; transition:opacity 0.5s; font-size:16px; margin-left:10px; }
  </style>
  
</head>
<body>
  <div class="container">
    <h1>Тестова система</h1>

    <a href="create.html" class="btn create">Създай нов тест</a>
    <a href="dashboard.html" class="btn dashboard">Учителски дашборд</a>

    <div style="margin-top:80px;">
      <h2 style="color:#2c3e50; font-size:32px;">Създадени тестове</h2>
      <div id="list"></div>
      <p id="empty" style="color:#95a5a6; font-size:22px; margin-top:50px; display:none;">
        Все още няма създадени тестове
      </p>
    </div>
  </div>

  <script>
    function shareTest(id) {
      const link = window.location.origin + window.location.pathname.replace(/index\.html.*$/, '') + 'take.html?id=' + id;
      navigator.clipboard.writeText(link).then(() => {
        const msg = event.target.nextElementSibling;
        msg.style.opacity = 1;
        setTimeout(() => msg.style.opacity = 0, 2000);
      }).catch(() => {
        prompt('Копирай този линк:', link);
      });
    }

    fetch('/api/tests')
      .then(r => r.json())
      .then(tests => {
        if (!tests || tests.length === 0) {
          document.getElementById('empty').style.display = 'block';
          return;
        }

        const html = tests.map(t => `
          <div class="test-card">
            <h3>${t.title}</h3>
            <p style="color:#666; font-size:18px; margin:10px 0;">
              Въпроси: <strong>${t.question_count}</strong>
            </p>

            <div class="actions">
              <a href="take.html?id=${t.id}" style="background:#06d6a0; color:white; padding:12px 24px; border-radius:50px; text-decoration:none; font-weight:bold;">
                Решаване
              </a>

              <button onclick="shareTest(${t.id})" class="share-btn">
                Сподели с ученици
              </button>
              <span class="copied">Копирано!</span>

              <button onclick="if(confirm('Изтриване на „${t.title}“?')) fetch('/api/tests/${t.id}',{method:'DELETE'}).then(()=>location.reload())"
                      style="background:#ef476f; color:white; padding:12px 24px; border:none; border-radius:50px; cursor:pointer; font-weight:bold;">
                Изтрий
              </button>
            </div>
          </div>
        `).join('');

        document.getElementById('list').innerHTML = html;
      })
      .catch(() => {
        document.getElementById('list').innerHTML = '<p style="color:red;">Грешка при зареждане!</p>';
      });
  </script>
  <!-- ГЛОБАЛЕН DARK MODE – сложи този код на ВСЯКА страница преди </body> -->
<script>
// Прилагаме текущото състояние
if (localStorage.getItem('dark') === 'true') {
  document.body.classList.add('dark');
}

// Създаваме бутончето (ако го няма)
document.addEventListener('DOMContentLoaded', () => {
  let btn = document.getElementById('global-dark-toggle');
  if (!btn) {
    btn = document.createElement('button');
    btn.id = 'global-dark-toggle';
    btn.textContent = document.body.classList.contains('dark') ? 'Light Mode' : 'Dark Mode';
    btn.style.cssText = `
      position:fixed; top:15px; right:15px; z-index:99999;
      background:rgba(0,0,0,0.7); color:white; border:none; padding:10px 18px;
      border-radius:50px; font-size:14px; font-weight:bold; cursor:pointer;
      box-shadow:0 4px 20px rgba(0,0,0,0.5); backdrop-filter:blur(10px);
    `;
    document.body.appendChild(btn);

    btn.onclick = () => {
      document.body.classList.toggle('dark');
      const isDark = document.body.classList.contains('dark');
      localStorage.setItem('dark', isDark);
      btn.textContent = isDark ? 'Light Mode' : 'Dark Mode';
    };
  }
});
</script>

<style>
/* ТЪМНА ТЕМА – работи за всички твои страници */
body.dark { background:#0d1117 !important; color:#c9d1d9 !important; }
body.dark .container,
body.dark .main,
body.dark .qblock,
body.dark .test-card { background:#161b22 !important; }
body.dark input,
body.dark select,
body.dark textarea { background:#0d1117 !important; color:#c9d1d9 !important; border-color:#30363d !important; }
body.dark hr { border-color:#30363d !important; }
body.dark .open-hint { background:#0d1117 !important; border-left-color:#58a6ff !important; color:#8b949e !important; }
body.dark .multi-count-options { background:#2d1a00 !important; color:#fff !important; }
body.dark table { background:#161b22 !important; }
body.dark th { background:#1f6feb !important; }
</style>
</body>
</html>